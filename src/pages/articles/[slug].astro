---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Breadcrumb from '../../components/Breadcrumb.astro';
import Figure from '../../components/Figure.astro';
import ArticleTags from '../../components/ArticleTags.astro';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
	const posts = await getCollection('article');
	return posts.map((post) => ({
		params: { slug: post.id },
		props: { post },
	}));
}

const { post } = Astro.props;
const { Content } = await render(post);
Astro.locals.postId = post.id;
---

<BaseLayout
	title={post.data.title}
	description={post.data.summary ?? undefined}
>
	<article>
		<header class="mb-10">
			<Breadcrumb
				items={[
					{ href: '/articles', label: 'Articles' },
					{ label: post.data.title },
				]}
			/>
			<h1 class="mt-2 text-3xl font-semibold tracking-tight text-slate-900 dark:text-slate-100">
				{post.data.title}
			</h1>
			<div class="mt-2 flex flex-wrap items-baseline gap-x-4 gap-y-0 text-slate-500 dark:text-slate-400">
				<time datetime={post.data.pubDate.toISOString()}>
					{post.data.pubDate.toLocaleDateString('en-US', {
						year: 'numeric',
						month: 'long',
						day: 'numeric',
					})}
				</time>
				{post.data.updatedDate ? (
					<time datetime={post.data.updatedDate.toISOString()} class="text-slate-400 dark:text-slate-500">
						Updated {post.data.updatedDate.toLocaleDateString('en-US', {
							year: 'numeric',
							month: 'long',
							day: 'numeric',
						})}
					</time>
				) : null}
			</div>
			{post.data.tags?.length ? (
				<div class="mt-3">
					<ArticleTags tags={post.data.tags} />
				</div>
			) : null}
		</header>
		<div class="post-body space-y-5 text-slate-700 leading-relaxed [&_h2]:mt-10 [&_h2]:text-xl [&_h2]:font-semibold [&_h2]:tracking-tight [&_h2]:text-slate-900 [&_h3]:mt-6 [&_h3]:text-lg [&_h3]:font-semibold [&_h3]:text-slate-900 [&_a]:underline [&_a]:decoration-slate-300 [&_a]:underline-offset-4 hover:[&_a]:decoration-slate-500 [&_p]:leading-relaxed [&_ul]:list-disc [&_ul]:pl-6 [&_ol]:list-decimal [&_ol]:pl-6 [&_img]:max-w-full [&_img]:rounded [&_img]:my-6 [&_img]:border [&_img]:border-slate-200 dark:text-slate-300 dark:[&_h2]:text-slate-100 dark:[&_h3]:text-slate-100 dark:[&_a]:decoration-slate-500 dark:hover:[&_a]:decoration-slate-400 dark:[&_img]:border-slate-700">
			<Content components={{ Figure }} />
		</div>
	</article>
	<p class="mt-14">
		<a
			href="/articles"
			class="text-slate-600 underline decoration-slate-300 underline-offset-4 hover:decoration-slate-500 dark:text-slate-400 dark:decoration-slate-500 dark:hover:decoration-slate-400"
		>
			‚Üê Back to articles
		</a>
	</p>
</BaseLayout>
