---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { ARTICLE_PAGE_SIZE } from '../../lib/constants';
import { excerptFromBody } from '../../lib/excerpt';

const allPosts = (await getCollection('article')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
const posts = allPosts.slice(0, ARTICLE_PAGE_SIZE);
const hasNextPage = allPosts.length > ARTICLE_PAGE_SIZE;
const nextPage = 2;
---

<BaseLayout title="Articles" description="Articles, most recent first.">
	<header class="mb-14">
		<h1 class="text-3xl font-semibold tracking-tight text-slate-900">Articles</h1>
		<p class="mt-2 text-lg text-slate-600">
			Posts in reverse chronological order.
		</p>
	</header>

	<nav aria-label="Article list">
		<ol class="space-y-12 list-none p-0 m-0">
			{posts.map((post) => (
				<li>
					<article class="border-b border-slate-200 pb-12 last:border-0">
						<h2 class="text-xl font-semibold tracking-tight">
							<a
								href={`/articles/${post.id}`}
								class="text-slate-900 underline decoration-slate-300 underline-offset-4 hover:decoration-slate-500 focus:outline focus:decoration-slate-700"
							>
								{post.data.title}
							</a>
						</h2>
						<time
							datetime={post.data.pubDate.toISOString()}
							class="mt-1 block text-sm text-slate-500"
						>
							{post.data.pubDate.toLocaleDateString('en-US', {
								year: 'numeric',
								month: 'long',
								day: 'numeric',
							})}
						</time>
						<p class="mt-3 text-slate-700 leading-relaxed">
							{post.data.summary ?? excerptFromBody(post.body)}
						</p>
					</article>
				</li>
			))}
		</ol>
	</nav>

	{hasNextPage ? (
		<p class="mt-14 text-slate-600">
			<a
				href="/articles/page/2"
				class="font-medium underline decoration-slate-300 underline-offset-4 hover:decoration-slate-500"
			>
				Older posts â†’
			</a>
		</p>
	) : null}
</BaseLayout>
