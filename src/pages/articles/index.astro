---
import BaseLayout from '../../layouts/BaseLayout.astro';
import ArticleTags from '../../components/ArticleTags.astro';
import { getCollection } from 'astro:content';
import { ARTICLE_PAGE_SIZE } from '../../lib/constants';
import { excerptFromBody } from '../../lib/excerpt';

const allPosts = (await getCollection('article')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
const posts = allPosts.slice(0, ARTICLE_PAGE_SIZE);
const hasNextPage = allPosts.length > ARTICLE_PAGE_SIZE;
---

<BaseLayout title="Articles" description="Articles, most recent first.">
	<header class="mb-14">
		<h1 class="text-3xl font-semibold tracking-tight text-slate-900 dark:text-slate-100">Articles</h1>
		<p class="mt-2 text-lg text-slate-600 dark:text-slate-400">
			All articles.
		</p>
	</header>

	<nav aria-label="Article list">
		<ol class="space-y-12 list-none p-0 m-0">
			{posts.map((post) => (
				<li>
					<article class="border-b border-slate-200 pb-12 last:border-0 dark:border-slate-700">
						<h2 class="text-xl font-semibold tracking-tight">
							<a
								href={`/articles/${post.id}`}
								class="text-slate-900 underline decoration-slate-300 underline-offset-4 hover:decoration-slate-500 focus:outline focus:decoration-slate-700 dark:text-slate-100 dark:decoration-slate-500 dark:hover:decoration-slate-400 dark:focus:decoration-slate-400"
							>
								{post.data.title}
							</a>
						</h2>
						<div class="mt-1 flex flex-wrap items-baseline gap-x-3 gap-y-0 text-sm text-slate-500 dark:text-slate-400">
							<time datetime={post.data.pubDate.toISOString()}>
								{post.data.pubDate.toLocaleDateString('en-US', {
									year: 'numeric',
									month: 'long',
									day: 'numeric',
								})}
							</time>
							{post.data.updatedDate ? (
								<time datetime={post.data.updatedDate.toISOString()} class="text-slate-400 dark:text-slate-500">
									Updated {post.data.updatedDate.toLocaleDateString('en-US', {
										year: 'numeric',
										month: 'long',
										day: 'numeric',
									})}
								</time>
							) : null}
						</div>
						{post.data.tags?.length ? (
							<div class="mt-2">
								<ArticleTags tags={post.data.tags} />
							</div>
						) : null}
						<p class="mt-3 text-slate-700 leading-relaxed dark:text-slate-300">
							{post.data.summary ?? excerptFromBody(post.body)}
						</p>
					</article>
				</li>
			))}
		</ol>
	</nav>

	{hasNextPage ? (
		<p class="mt-14 text-slate-600 dark:text-slate-400">
			<a
				href="/articles/page/2"
				class="font-medium underline decoration-slate-300 underline-offset-4 hover:decoration-slate-500 dark:decoration-slate-500 dark:hover:decoration-slate-400"
			>
				Older posts â†’
			</a>
		</p>
	) : null}
</BaseLayout>
